---
layout: post
title:  "라즈베리파이3, u-boot를 이용한 raspbian 부팅"
date:   2019-06-07 23:00:00 +0900
categories: safari HTML CSS SVG FrontEnd
---
예전에 연구실에서 후배가 진행했던 프로젝트가 있었는데 마땅한 결과를 얻지 못해서 아쉬웠던 때가 있었다. 당시에 나는 졸업 준비를 하고 있어서 제대로 도와주지 못했다. 이제 졸업 준비도 모두 마무리 했고, 당시에 시도하고 싶은 내용이 있어서 남은 시간에 다시 한번 도전해보려고 한다. 이를 위해서는 라즈베리파이3 B 모델에 u-boot를 이용하여 raspbian을 부팅해야 한다. 추후에 같은 과정을 진행할 수 있기 때문에 u-boot에 대한 내용과 raspbian 부팅에 대한 과정을 메모하고자 글을 작성한다. 

## U-Boot

## Raspbian 

## U-Boot를 이용하여 Raspbian 부팅 과정 

**본 글은 Fedora 29 환경에서 시도하였다.**

먼저 u-boot 소스코드를 github에서 clone 한다. 

```bash
$ git clone https://github.com/u-boot/u-boot
```

그리고, 다음과 같이 *ARCH* 환경변수와 *CROSS_COMPILE* 환경변수를 설정한다. ARCH 환경변수는 컴파일 할 대상에 대한 아키텍처를 의미하고, CROSS_COMPILE은 컴파일 할 대상을 위한 Cross Compiler를 설정하는 것이다. 

```bash
$ export ARCH=arm
$ export CROSS_COMPILE=arm-linux-gnu-
```

*주의할 점은 CROSS_COMPILE에 입력해야 할 Cross Compiler Toolchain은 리눅스 배포판마다 다르다. 이를 주의하여 입력한다. 우분투 같은 경우에는 arm-linux-gnueabihf- 툴을 설치하는 것으로 알고 있다. *

ARCH 환경변수와 CROSS_COMPILE 환경변수를 입력하였으면, 다음과 같이 컴파일을 진행한다. 

```bash
$ make rpi_3_32b_defconfig
$ make all
```

rpi_3_32b_defconfig에는 Raspberry Pi 3 32bit에 대한 

```
fatload mmc 0:1 ${kernel_addr_r} kernel7.img
fatload mmc 0:1 ${fdt_addr_r} bcm2710-rpi-3-b.dtb

fatload mmc 0:1 ${kernel_addr_r} zImage
# IMPORTANT NOTE: On mainline u-boot, the correct variable to use here is ${fdt_addr} and NOT ${fdt_addr_r}
fatload mmc 0:1 ${fdt_addr_r} ${fdtfile}
setenv bootargs earlyprintk console=tty0 console=ttyAMA0 root=/dev/mmcblk0p2 rootfstype=ext4 rootwait noinitrd
# IMPORTANT NOTE: On mainline u-boot, the correct variable to use here is ${fdt_addr} and NOT ${fdt_addr_r}
bootz ${kernel_addr_r} - ${fdt_addr_r}

bootz ${kernel_addr_r} - ${fdt_addr_r}
```

## Troubleshootings
Kernel panic-not syncing: VFS: unable to mount root fs on unknown-block(0,0)

## 결론 